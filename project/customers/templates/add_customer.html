{% extends 'base.html' %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

{% block content %}

  {% macro validate_field(field) %}
    {% if field.errors %}
      <div class=errors>
      {% for error in field.errors %}
        <p>{{ error }}</p>
      {% endfor %}
    </div>
    {% endif %}
  {% endmacro %}

  <h1> Create a new Customer </h1>

  <form method="POST" action="/add_customer">>
      {{ form.csrf_token }}
          {{ form.name.label }}
          {{ form.name }}
          {{ validate_field(form.name) }}<br><br>

          {{ form.city.label }}
          {{ form.city }}
          {{ validate_field(form.city) }}<br><br>

          {{ form.age.label }}
          {{ form.age }}
          {{ validate_field(form.age) }}<br><br>

          {{ form.submit() }}

  </form>
{% endblock %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector("form");

    form.addEventListener("submit", function (e) {
      e.preventDefault(); // Prevent the default form submission behavior

      const formData = new FormData(form);

      axios
        .post("/add_customer", {
          name: formData.get("name"),
          city: formData.get("city"),
          age: formData.get("age"),
        })
        .then(function (response) {
          // Handle a successful response from the server (e.g., show a success message)
          console.log(response.data);
          alert("Customer added successfully!");
        })
        .catch(function (error) {
          // Handle errors (e.g., show an error message)
          console.error(error);
          alert("Error adding customer. Please check the form and try again.");
        });
    });
  });
</script>



